// Pixel-art texture generation utility
// Renders 2D pixel maps into Phaser textures with retro aesthetic

const PALETTE = {
    0: null,             // transparent
    1: 0x2d5a27,         // body dark
    2: 0x6ab04c,         // body light
    3: 0xffffff,         // eye white
    4: 0x1a1a2e,         // eye pupil
    5: 0x1a3c13,         // membrane / outline
    6: 0xe17055,         // organelle accent
    7: 0xfdcb6e,         // organelle accent 2
    8: 0x4a8b3f,         // body mid
    9: 0x78e08f,         // highlight
    10: 0xc0392b,        // danger red
    11: 0x0a3d0a,        // dark green
    12: 0x3498db,        // blue accent
    13: 0x8e44ad,        // purple accent
    14: 0xf39c12,        // orange glow
    15: 0x2c3e50,        // dark base
};

function generateCreatureTexture(scene, key, pixelMap, pixelSize, palette) {
    const pal = palette || PALETTE;
    const h = pixelMap.length;
    const w = pixelMap[0].length;
    const texW = w * pixelSize;
    const texH = h * pixelSize;

    const gfx = scene.add.graphics();

    for (let y = 0; y < h; y++) {
        for (let x = 0; x < w; x++) {
            const idx = pixelMap[y][x];
            if (idx === 0 || pal[idx] == null) continue;
            gfx.fillStyle(pal[idx], 1);
            gfx.fillRect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
        }
    }

    gfx.generateTexture(key, texW, texH);
    gfx.destroy();
}

// Mirror a half-map to create horizontal symmetry
function mirrorMap(halfMap) {
    return halfMap.map(row => {
        const mirrored = [...row].reverse();
        // If odd width, don't duplicate center column
        return [...row, ...mirrored.slice(1)];
    });
}

// Creature pixel maps â€” defined as right-half, then mirrored

const CREATURE_MAPS = {
    // Tier 1: 8x8 tiny blob
    creature_t1: {
        pixelSize: 3,
        map: mirrorMap([
            [0,0,0,0,0],
            [0,0,5,5,0],
            [0,5,2,2,2],
            [0,5,2,3,4],
            [0,5,2,2,2],
            [0,5,1,2,1],
            [0,0,5,5,0],
            [0,0,0,0,0],
        ])
    },

    // Tier 2: 12x12 amoeba
    creature_t2: {
        pixelSize: 3,
        map: mirrorMap([
            [0,0,0,0,0,0,0],
            [0,0,0,5,5,0,0],
            [0,0,5,2,2,5,0],
            [0,5,2,2,2,2,5],
            [0,5,2,8,2,2,5],
            [0,5,2,3,4,2,5],
            [0,5,2,2,2,2,5],
            [0,5,1,2,6,2,5],
            [0,5,1,1,2,1,5],
            [0,0,5,1,1,5,0],
            [0,0,0,5,5,0,0],
            [0,0,0,0,0,0,0],
        ])
    },

    // Tier 3: 16x16 cell with organelles
    creature_t3: {
        pixelSize: 2,
        map: mirrorMap([
            [0,0,0,0,0,0,0,0,0],
            [0,0,0,0,5,5,5,0,0],
            [0,0,0,5,2,2,2,5,0],
            [0,0,5,2,2,8,2,2,5],
            [0,5,2,2,7,7,2,2,5],
            [0,5,2,8,2,2,8,2,5],
            [0,5,2,2,2,3,4,2,5],
            [0,5,2,6,2,3,4,2,5],
            [0,5,2,6,2,2,2,2,5],
            [0,5,1,2,2,6,2,1,5],
            [0,5,1,2,8,2,2,1,5],
            [0,5,1,1,2,2,1,1,5],
            [0,0,5,1,1,1,1,5,0],
            [0,0,0,5,5,1,5,0,0],
            [0,0,0,0,0,5,0,0,0],
            [0,0,0,0,0,0,0,0,0],
        ])
    },

    // Tier 4: 24x24 predator with spikes
    creature_t4: {
        pixelSize: 2,
        map: mirrorMap([
            [0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,5,0,0,0,0,0,0],
            [0,0,0,0,0,5,5,0,0,0,0,0,0],
            [0,0,0,0,5,1,5,5,0,0,0,0,0],
            [0,0,0,5,1,1,2,2,5,0,0,0,0],
            [0,0,5,1,1,2,2,2,2,5,0,0,0],
            [0,5,1,1,2,2,8,2,2,5,0,5,0],
            [0,5,1,2,2,8,2,2,2,2,5,5,0],
            [0,5,1,2,2,2,2,3,3,2,2,5,0],
            [0,5,1,2,6,2,2,4,4,2,2,5,0],
            [0,5,1,2,6,6,2,3,3,2,2,5,0],
            [0,5,1,2,2,2,2,2,2,2,2,5,0],
            [5,5,1,2,2,7,7,2,2,8,2,5,0],
            [0,5,1,2,2,7,7,2,2,2,5,0,0],
            [0,5,1,1,2,2,2,2,10,2,5,0,0],
            [0,5,1,1,1,2,2,10,10,2,5,0,0],
            [0,0,5,1,1,1,2,2,2,5,0,0,0],
            [0,0,5,5,1,1,1,2,5,0,0,0,0],
            [0,0,0,5,5,1,1,5,5,0,0,0,0],
            [0,0,0,0,5,5,5,5,0,0,0,0,0],
            [0,0,0,0,0,5,5,0,0,0,0,0,0],
            [0,0,0,0,0,0,5,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0],
        ])
    },

    // Tier 5: 32x32 boss with multiple eyes
    creature_t5: {
        pixelSize: 2,
        map: mirrorMap([
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,5,5,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,5,11,5,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,5,11,1,1,5,0,0,0,0,0,0],
            [0,0,0,0,0,5,11,1,1,2,2,5,0,0,0,0,0],
            [0,0,0,0,5,11,1,1,2,2,2,2,5,0,0,0,0],
            [0,0,0,5,11,1,1,2,2,8,2,2,5,0,0,5,0],
            [0,0,5,11,1,1,2,2,3,3,2,2,2,5,5,5,0],
            [0,5,11,1,1,2,2,2,4,4,2,2,2,2,5,0,0],
            [0,5,1,1,2,2,8,2,3,3,2,7,2,2,5,0,0],
            [0,5,1,2,2,2,2,2,2,2,2,7,7,2,5,0,0],
            [0,5,1,2,2,6,6,2,2,3,3,2,2,2,5,0,0],
            [0,5,1,2,6,6,6,2,2,4,4,2,2,2,2,5,0],
            [0,5,1,2,2,6,2,2,2,2,2,2,8,2,2,5,0],
            [5,5,1,2,2,2,2,2,13,13,2,2,2,2,5,0,0],
            [0,5,1,2,2,8,2,13,13,13,2,2,2,5,0,0,0],
            [0,5,1,1,2,2,2,2,13,2,2,10,2,5,0,0,0],
            [0,5,1,1,1,2,2,2,2,2,10,10,5,0,0,0,0],
            [0,0,5,1,1,1,2,2,2,2,10,5,0,0,0,0,0],
            [0,0,5,11,1,1,1,2,2,2,5,0,0,0,0,0,0],
            [0,0,0,5,11,1,1,1,2,5,0,0,0,0,0,0,0],
            [0,0,0,0,5,5,1,1,5,5,0,0,0,0,0,0,0],
            [0,0,0,0,0,5,5,5,5,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,5,5,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        ])
    },

    // Tier 6: 48x48 leviathan
    creature_t6: {
        pixelSize: 2,
        map: mirrorMap([
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,5,5,5,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,5,11,11,5,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,5,11,1,1,1,5,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,5,11,1,1,1,2,2,5,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,5,11,1,1,1,2,2,2,2,5,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,5,11,1,1,2,2,2,8,2,2,2,5,0,0,0,0,0,0],
            [0,0,0,0,0,0,5,11,1,1,2,2,2,8,2,2,2,2,5,0,0,0,5,0,0],
            [0,0,0,0,0,5,11,1,1,2,2,2,3,3,2,2,2,2,2,5,0,5,5,0,0],
            [0,0,0,0,5,11,1,1,2,2,2,2,4,4,2,7,2,2,2,2,5,5,0,0,0],
            [0,0,0,5,11,1,1,2,2,8,2,2,3,3,2,7,7,2,2,2,2,5,0,0,0],
            [0,0,5,11,1,1,2,2,2,2,2,2,2,2,2,2,7,2,2,2,2,5,0,0,0],
            [0,5,11,1,1,2,2,6,6,2,2,2,3,3,2,2,2,2,2,2,2,2,5,0,0],
            [0,5,1,1,2,2,6,6,6,6,2,2,4,4,2,2,2,8,2,2,2,2,5,0,0],
            [0,5,1,2,2,2,6,6,2,2,2,2,2,2,2,13,13,2,2,2,2,5,0,0],
            [0,5,1,2,2,2,2,2,2,2,2,13,13,2,13,13,13,2,2,2,2,2,5,0],
            [5,5,1,2,2,8,2,2,2,13,13,13,13,2,2,13,2,2,2,2,2,2,5,0],
            [0,5,1,2,2,2,2,2,2,13,13,2,2,2,2,2,2,2,10,10,2,2,5,0],
            [0,5,1,1,2,2,2,2,2,2,2,2,2,8,2,2,2,10,10,10,2,5,0,0],
            [0,5,1,1,1,2,2,2,2,2,2,2,2,2,2,2,10,10,2,2,5,0,0,0],
            [0,0,5,1,1,1,2,2,2,2,8,2,2,2,2,2,2,2,2,5,0,0,0,0,0],
            [0,0,5,11,1,1,1,2,2,2,2,2,2,2,2,2,2,2,5,0,0,0,0,0,0],
            [0,0,0,5,11,1,1,1,2,2,2,2,2,2,2,2,2,5,0,0,0,0,0,0,0],
            [0,0,0,0,5,11,1,1,1,1,2,2,2,2,2,2,5,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,5,5,11,1,1,1,1,2,2,2,5,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,5,5,1,1,1,1,2,5,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,5,5,5,1,1,5,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,5,5,5,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        ])
    },

    // Player-specific textures (same shapes, different accent color)
    player_t1: {
        pixelSize: 3,
        map: mirrorMap([
            [0,0,0,0,0],
            [0,0,5,5,0],
            [0,5,9,9,9],
            [0,5,9,3,4],
            [0,5,9,9,9],
            [0,5,2,9,2],
            [0,0,5,5,0],
            [0,0,0,0,0],
        ])
    },

    player_t2: {
        pixelSize: 3,
        map: mirrorMap([
            [0,0,0,0,0,0,0],
            [0,0,0,5,5,0,0],
            [0,0,5,9,9,5,0],
            [0,5,9,9,9,9,5],
            [0,5,9,8,9,9,5],
            [0,5,9,3,4,9,5],
            [0,5,9,9,9,9,5],
            [0,5,2,9,7,9,5],
            [0,5,2,2,9,2,5],
            [0,0,5,2,2,5,0],
            [0,0,0,5,5,0,0],
            [0,0,0,0,0,0,0],
        ])
    },

    player_t3: {
        pixelSize: 2,
        map: mirrorMap([
            [0,0,0,0,0,0,0,0,0],
            [0,0,0,0,5,5,5,0,0],
            [0,0,0,5,9,9,9,5,0],
            [0,0,5,9,9,8,9,9,5],
            [0,5,9,9,7,7,9,9,5],
            [0,5,9,8,9,9,8,9,5],
            [0,5,9,9,9,3,4,9,5],
            [0,5,9,12,9,3,4,9,5],
            [0,5,9,12,9,9,9,9,5],
            [0,5,2,9,9,12,9,2,5],
            [0,5,2,9,8,9,9,2,5],
            [0,5,2,2,9,9,2,2,5],
            [0,0,5,2,2,2,2,5,0],
            [0,0,0,5,5,2,5,0,0],
            [0,0,0,0,0,5,0,0,0],
            [0,0,0,0,0,0,0,0,0],
        ])
    },

    player_t4: {
        pixelSize: 2,
        map: mirrorMap([
            [0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,5,0,0,0,0,0,0],
            [0,0,0,0,0,5,5,0,0,0,0,0,0],
            [0,0,0,0,5,2,5,5,0,0,0,0,0],
            [0,0,0,5,2,2,9,9,5,0,0,0,0],
            [0,0,5,2,2,9,9,9,9,5,0,0,0],
            [0,5,2,2,9,9,8,9,9,5,0,5,0],
            [0,5,2,9,9,8,9,9,9,9,5,5,0],
            [0,5,2,9,9,9,9,3,3,9,9,5,0],
            [0,5,2,9,12,9,9,4,4,9,9,5,0],
            [0,5,2,9,12,12,9,3,3,9,9,5,0],
            [0,5,2,9,9,9,9,9,9,9,9,5,0],
            [5,5,2,9,9,7,7,9,9,8,9,5,0],
            [0,5,2,9,9,7,7,9,9,9,5,0,0],
            [0,5,2,2,9,9,9,9,14,9,5,0,0],
            [0,5,2,2,2,9,9,14,14,9,5,0,0],
            [0,0,5,2,2,2,9,9,9,5,0,0,0],
            [0,0,5,5,2,2,2,9,5,0,0,0,0],
            [0,0,0,5,5,2,2,5,5,0,0,0,0],
            [0,0,0,0,5,5,5,5,0,0,0,0,0],
            [0,0,0,0,0,5,5,0,0,0,0,0,0],
            [0,0,0,0,0,0,5,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0],
        ])
    },

    player_t5: {
        pixelSize: 2,
        map: mirrorMap([
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,5,5,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,5,11,5,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,5,11,2,2,5,0,0,0,0,0,0],
            [0,0,0,0,0,5,11,2,2,9,9,5,0,0,0,0,0],
            [0,0,0,0,5,11,2,2,9,9,9,9,5,0,0,0,0],
            [0,0,0,5,11,2,2,9,9,8,9,9,5,0,0,5,0],
            [0,0,5,11,2,2,9,9,3,3,9,9,9,5,5,5,0],
            [0,5,11,2,2,9,9,9,4,4,9,9,9,9,5,0,0],
            [0,5,2,2,9,9,8,9,3,3,9,7,9,9,5,0,0],
            [0,5,2,9,9,9,9,9,9,9,9,7,7,9,5,0,0],
            [0,5,2,9,9,12,12,9,9,3,3,9,9,9,5,0,0],
            [0,5,2,9,12,12,12,9,9,4,4,9,9,9,9,5,0],
            [0,5,2,9,9,12,9,9,9,9,9,9,8,9,9,5,0],
            [5,5,2,9,9,9,9,9,13,13,9,9,9,9,5,0,0],
            [0,5,2,9,9,8,9,13,13,13,9,9,9,5,0,0,0],
            [0,5,2,2,9,9,9,9,13,9,9,14,9,5,0,0,0],
            [0,5,2,2,2,9,9,9,9,9,14,14,5,0,0,0,0],
            [0,0,5,2,2,2,9,9,9,9,14,5,0,0,0,0,0],
            [0,0,5,11,2,2,2,9,9,9,5,0,0,0,0,0,0],
            [0,0,0,5,11,2,2,2,9,5,0,0,0,0,0,0,0],
            [0,0,0,0,5,5,2,2,5,5,0,0,0,0,0,0,0],
            [0,0,0,0,0,5,5,5,5,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,5,5,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        ])
    },
};

// Food particle (tiny green dot)
const FOOD_MAP = {
    pixelSize: 2,
    map: [
        [0, 9, 0],
        [9, 2, 9],
        [0, 9, 0],
    ]
};
